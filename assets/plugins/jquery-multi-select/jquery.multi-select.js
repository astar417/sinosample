!function(a){var b=function(c,d){this.options=d;this.$element=a(c);this.$container=a("<div/>",{"class":"ms-container"});this.$selectableContainer=a("<div/>",{"class":"ms-selectable"});this.$selectionContainer=a("<div/>",{"class":"ms-selection"});this.$selectableUl=a("<ul/>",{"class":"ms-list",tabindex:"-1"});this.$selectionUl=a("<ul/>",{"class":"ms-list",tabindex:"-1"});this.scrollTo=0;this.sanitizeRegexp=new RegExp("\\W+","gi");this.elemsSelector="li:visible:not(.ms-optgroup-label,.ms-optgroup-container,."+d.disabledClass+")"};b.prototype={constructor:b,init:function(){var f=this,d=this.$element;if(d.next(".ms-container").length===0){d.css({position:"absolute",left:"-9999px"});d.attr("id",d.attr("id")?d.attr("id"):Math.ceil(Math.random()*1000)+"multiselect");this.$container.attr("id","ms-"+d.attr("id"));d.find("option").each(function(){f.generateLisFromOption(this)});this.$selectionUl.find(".ms-optgroup-label").hide();if(f.options.selectableHeader){f.$selectableContainer.append(f.options.selectableHeader)}f.$selectableContainer.append(f.$selectableUl);if(f.options.selectableFooter){f.$selectableContainer.append(f.options.selectableFooter)}if(f.options.selectionHeader){f.$selectionContainer.append(f.options.selectionHeader)}f.$selectionContainer.append(f.$selectionUl);if(f.options.selectionFooter){f.$selectionContainer.append(f.options.selectionFooter)}f.$container.append(f.$selectableContainer);f.$container.append(f.$selectionContainer);d.after(f.$container);f.activeMouse(f.$selectableUl);f.activeKeyboard(f.$selectableUl);var c=f.options.dblClick?"dblclick":"click";f.$selectableUl.on(c,".ms-elem-selectable",function(){f.select(a(this).data("ms-value"))});f.$selectionUl.on(c,".ms-elem-selection",function(){f.deselect(a(this).data("ms-value"))});f.activeMouse(f.$selectionUl);f.activeKeyboard(f.$selectionUl);d.on("focus",function(){f.$selectableUl.focus()})}var e=d.find("option:selected").map(function(){return a(this).val()}).get();f.select(e,"init");if(typeof f.options.afterInit==="function"){f.options.afterInit.call(this,this.$container)}},generateLisFromOption:function(p){var s=this,k=s.$element,h="",d=a(p);for(var i=0;i<p.attributes.length;i++){var g=p.attributes[i];if(g.name!=="value"&&g.name!=="disabled"){h+=g.name+'="'+g.value+'" '}}var q=a("<li "+h+"><span>"+d.text()+"</span></li>"),r=q.clone(),t=d.val(),j=s.sanitize(t,s.sanitizeRegexp);q.data("ms-value",t).addClass("ms-elem-selectable").attr("id",j+"-selectable");r.data("ms-value",t).addClass("ms-elem-selection").attr("id",j+"-selection").hide();if(d.prop("disabled")||k.prop("disabled")){r.addClass(s.options.disabledClass);q.addClass(s.options.disabledClass)}var c=d.parent("optgroup");if(c.length>0){var n=c.attr("label"),m=s.sanitize(n,s.sanitizeRegexp),e=s.$selectableUl.find("#optgroup-selectable-"+m),f=s.$selectionUl.find("#optgroup-selection-"+m);if(e.length===0){var l='<li class="ms-optgroup-container"></li>',o='<ul class="ms-optgroup"><li class="ms-optgroup-label"><span>'+n+"</span></li></ul>";e=a(l);f=a(l);e.attr("id","optgroup-selectable-"+m);f.attr("id","optgroup-selection-"+m);e.append(a(o));f.append(a(o));if(s.options.selectableOptgroup){e.find(".ms-optgroup-label").on("click",function(){var u=c.children(":not(:selected)").map(function(){return a(this).val()}).get();s.select(u)});f.find(".ms-optgroup-label").on("click",function(){var u=c.children(":selected").map(function(){return a(this).val()}).get();s.deselect(u)})}s.$selectableUl.append(e);s.$selectionUl.append(f)}e.children().append(q);f.children().append(r)}else{s.$selectableUl.append(q);s.$selectionUl.append(r)}},activeKeyboard:function(c){var d=this;c.on("focus",function(){a(this).addClass("ms-focus")}).on("blur",function(){a(this).removeClass("ms-focus")}).on("keydown",function(f){switch(f.which){case 40:case 38:f.preventDefault();f.stopPropagation();d.moveHighlight(a(this),(f.which===38)?-1:1);return;case 32:f.preventDefault();f.stopPropagation();d.selectHighlighted(c);return;case 37:case 39:f.preventDefault();f.stopPropagation();d.switchList(c);return}})},moveHighlight:function(e,m){var d=e.find(this.elemsSelector),c=d.filter(".ms-hover"),f=null,n=d.first().outerHeight(),k=e.height(),l="#"+this.$container.prop("id");d.off("mouseenter");d.removeClass("ms-hover");if(m===1){f=c.nextAll(this.elemsSelector).first();if(f.length===0){var i=c.parent();if(i.hasClass("ms-optgroup")){var h=i.parent(),g=h.next(":visible");if(g.length>0){f=g.find(this.elemsSelector).first()}else{f=d.first()}}else{f=d.first()}}}else{if(m===-1){f=c.prevAll(this.elemsSelector).first();if(f.length===0){var i=c.parent();if(i.hasClass("ms-optgroup")){var h=i.parent(),j=h.prev(":visible");if(j.length>0){f=j.find(this.elemsSelector).last()}else{f=d.last()}}else{f=d.last()}}}}if(f.length>0){f.addClass("ms-hover");var o=e.scrollTop()+f.position().top-k/2+n/2;e.scrollTop(o)}},selectHighlighted:function(e){var c=e.find(this.elemsSelector),d=c.filter(".ms-hover").first();if(d.length>0){if(e.parent().hasClass("ms-selectable")){this.select(d.data("ms-value"))}else{this.deselect(d.data("ms-value"))}c.removeClass("ms-hover")}},switchList:function(c){c.blur();if(c.parent().hasClass("ms-selectable")){this.$selectionUl.focus()}else{this.$selectableUl.focus()}},activeMouse:function(c){var d=this;c.on("mousemove",function(){var e=c.find(d.elemsSelector);e.on("mouseenter",function(){e.removeClass("ms-hover");a(this).addClass("ms-hover")})})},refresh:function(){this.destroy();this.$element.multiSelect(this.options)},destroy:function(){a("#ms-"+this.$element.attr("id")).remove();this.$element.removeData("multiselect")},select:function(m,c){if(typeof m==="string"){m=[m]}var l=this,d=this.$element,e=a.map(m,function(n){return(l.sanitize(n,l.sanitizeRegexp))}),h=this.$selectableUl.find("#"+e.join("-selectable, #")+"-selectable").filter(":not(."+l.options.disabledClass+")"),k=this.$selectionUl.find("#"+e.join("-selection, #")+"-selection").filter(":not(."+l.options.disabledClass+")"),f=d.find("option:not(:disabled)").filter(function(){return(a.inArray(this.value,m)>-1)});if(h.length>0){h.addClass("ms-selected").hide();k.addClass("ms-selected").show();f.prop("selected",true);var g=l.$selectableUl.children(".ms-optgroup-container");if(g.length>0){g.each(function(){var n=a(this).find(".ms-elem-selectable");if(n.length===n.filter(".ms-selected").length){a(this).find(".ms-optgroup-label").hide()}});var j=l.$selectionUl.children(".ms-optgroup-container");j.each(function(){var n=a(this).find(".ms-elem-selection");if(n.filter(".ms-selected").length>0){a(this).find(".ms-optgroup-label").show()}})}else{if(l.options.keepOrder){var i=l.$selectionUl.find(".ms-selected");if((i.length>1)&&(i.last().get(0)!=k.get(0))){k.insertAfter(i.last())}}}if(c!=="init"){d.trigger("change");if(typeof l.options.afterSelect==="function"){l.options.afterSelect.call(this,m)}}}},deselect:function(k){if(typeof k==="string"){k=[k]}var j=this,c=this.$element,d=a.map(k,function(l){return(j.sanitize(l,j.sanitizeRegexp))}),g=this.$selectableUl.find("#"+d.join("-selectable, #")+"-selectable"),i=this.$selectionUl.find("#"+d.join("-selection, #")+"-selection").filter(".ms-selected"),e=c.find("option").filter(function(){return(a.inArray(this.value,k)>-1)});if(i.length>0){g.removeClass("ms-selected").show();i.removeClass("ms-selected").hide();e.prop("selected",false);var f=j.$selectableUl.children(".ms-optgroup-container");if(f.length>0){f.each(function(){var l=a(this).find(".ms-elem-selectable");if(l.filter(":not(.ms-selected)").length>0){a(this).find(".ms-optgroup-label").show()}});var h=j.$selectionUl.children(".ms-optgroup-container");h.each(function(){var l=a(this).find(".ms-elem-selection");if(l.filter(".ms-selected").length===0){a(this).find(".ms-optgroup-label").hide()}})}c.trigger("change");if(typeof j.options.afterDeselect==="function"){j.options.afterDeselect.call(this,k)}}},select_all:function(){var c=this.$element,e=c.val();c.find('option:not(":disabled")').prop("selected",true);this.$selectableUl.find(".ms-elem-selectable").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").show();this.$selectionUl.focus();c.trigger("change");if(typeof this.options.afterSelect==="function"){var d=a.grep(c.val(),function(f){return a.inArray(f,e)<0});this.options.afterSelect.call(this,d)}},deselect_all:function(){var c=this.$element,d=c.val();c.find("option").prop("selected",false);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focus();c.trigger("change");if(typeof this.options.afterDeselect==="function"){this.options.afterDeselect.call(this,d)}},sanitize:function(d,c){return(d.replace(c,"_"))}};a.fn.multiSelect=function(){var d=arguments[0],c=arguments;return this.each(function(){var e=a(this),f=e.data("multiselect"),g=a.extend({},a.fn.multiSelect.defaults,e.data(),typeof d==="object"&&d);if(!f){e.data("multiselect",(f=new b(this,g)))}if(typeof d==="string"){f[d](c[1])}else{f.init()}})};a.fn.multiSelect.defaults={selectableOptgroup:false,disabledClass:"disabled",dblClick:false,keepOrder:false};a.fn.multiSelect.Constructor=b}(window.jQuery);